//  easy-logging.min.js 0.1.0

/*  (c) 2013 Leroy Baeyens
 *  @license: easy-logging may be distributed under the GPL license 
 */
(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function(e){var t=Backbone.Model.extend({defaults:{message:"content of the log",date:""},initialize:function(e){_.extend(this,e)},url:function(){return this.saveToUrl},reformatDate:function(e){this.set("date",this.formatDate(new Date,e,true,true))},formatDate:function(e,t,n,r){n=typeof n=="undefined"?false:n;r=typeof r=="undefined"?false:r;t=t.replace("DD",(n?e.getDate()<10?"0":"":"")+e.getDate());t=t.replace("MM",(n?e.getMonth()<9?"0":"":"")+(e.getMonth()+1));t=t.replace("YYYY",e.getFullYear());t=t.replace("HH",(r?e.getHours()<9?"0":"":"")+e.getHours());t=t.replace("II",(r?e.getMinutes()<9?"0":"":"")+e.getMinutes());t=t.replace("SS",(r?e.getSeconds()<9?"0":"":"")+e.getSeconds());return t}});window.easyLogger=Backbone.View.extend({enabled:true,console:false,upload:true,prefix:"",suffix:"",url:"api/log",selector:"log",groupRest:"custom",remember:5,dateformat:"YYYY-MM-DD HH:II:SS",defaults:{},el:document,prevLogs:[],model:{},events:{click:"logEvent"},initialize:function(e){_.extend(this,e)},setMessage:function(e,t){t=typeof t=="undefined"?false:t;var n="";if(!t&&typeof this.prefix!="undefined"&&this.prefix.length>0){n+=this.prefix.trim()+" "}n+=e;if(!t&&typeof this.suffix!="undefined"&&this.suffix.length>0){n+=" "+this.suffix.trim()}this.model.set("message",n);return this},logEvent:function(t){t.preventDefault();var n=e(t.target);if(typeof n.data(this.selector)!="undefined"){this.newModel().setMessage(n.data(this.selector));this.model.reformatDate(this.dateformat);this.saveLog()}},log:function(e,t){this.newModel().setMessage(e.message,t);this.model.reformatDate(this.dateformat);delete e.message;if(!_.isEmpty(e)){if(typeof this.groupRest=="string"){this.model.set(this.groupRest,e)}else if(typeof this.groupRest=="boolean"){if(this.groupRest==true){console.log("if you want to group the remaining items, please use a string")}else{var n=this;_.each(e,function(e,t){n.model.set(t,e)})}}}this.saveLog()},newModel:function(){this.model=new t(this.defaults),this.model.saveToUrl=this.url;return this},addLog:function(e){var t=typeof this.remember=="number"?this.remember:2;if(this.prevLogs.length==t){this.prevLogs.shift()}this.prevLogs.push(e)},saveLog:function(){this.addLog(this.model.toJSON());if(typeof this.enabled=="boolean"&&this.enabled==true){if(typeof this.console=="boolean"&&this.console==true){console.log(this.model.toJSON())}if(typeof this.upload=="boolean"&&this.upload==true){this.model.save()}}}})})